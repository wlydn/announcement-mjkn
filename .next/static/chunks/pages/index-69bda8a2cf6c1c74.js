(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{1214:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>o});var n=t(7876),r=t(4232),l=t(1040);let s=async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;for(let n=1;n<=a;n++)try{return await e()}catch(e){if(n===a)throw e;if("ECONNABORTED"===e.code||"ENOTFOUND"===e.code||e.message.includes("timeout")||e.message.includes("network")){let e=t*Math.pow(2,n-1);console.log(`Request failed (attempt ${n}/${a}), retrying in ${e}ms...`),await new Promise(a=>setTimeout(a,e))}else throw e}},i=function(){let[e,a]=(0,r.useState)([]),[t,i]=(0,r.useState)({fajr:"05:30",dhuhr:"12:00",asr:"15:30",maghrib:"18:00",isha:"19:30"}),[o,u]=(0,r.useState)(!1),[c,m]=(0,r.useState)(0),[d,g]=(0,r.useState)(0),[h,p]=(0,r.useState)({message:"",type:""}),[f,v]=(0,r.useState)(""),[k,j]=(0,r.useState)(""),[y,S]=(0,r.useState)(0),[N,x]=(0,r.useState)(!1),b=(0,r.useRef)(null),I=(0,r.useRef)(null),w=e=>({fajr:"Subuh",dhuhr:"Dzuhur",asr:"Ashar",maghrib:"Maghrib",isha:"Isya"})[e]||e,T=(0,r.useCallback)((e,a)=>{p({message:e,type:a}),setTimeout(()=>{p({message:"",type:""})},5e3)},[]),E=(0,r.useCallback)(()=>{let e=new Date().getTime();for(let[a,n]of Object.entries(t)){let[a,t]=n.split(":").map(Number),r=new Date;r.setHours(a,t,0,0);let l=r.getTime(),s=l+18e5;if(e>=l&&e<=s)return!0}return!1},[t]),D=(0,r.useCallback)(()=>{let e=new Date().getTime();for(let[a,n]of Object.entries(t)){let[t,r]=n.split(":").map(Number),l=new Date;l.setHours(t,r,0,0);let s=l.getTime()+3e5+18e4;if(e>=s&&e<=s+12e4)return{canPlay:!0,prayerName:w(a)}}return{canPlay:!1,prayerName:null}},[t]),M=(0,r.useCallback)(()=>{let e=new Date().getTime();for(let[a,n]of Object.entries(t)){let[t,r]=n.split(":").map(Number),l=new Date;l.setHours(t,r,0,0);let s=l.getTime(),i=s+36e5;if(e>=s&&e<=i)return w(a)}return"Shalat"},[t]);(0,r.useEffect)(()=>{let e=()=>{let e=new Date;v(e.toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"})),j(e.toLocaleTimeString("id-ID"))};e();let a=setInterval(e,1e3);return()=>clearInterval(a)},[]),(0,r.useEffect)(()=>{let e=async()=>{if(navigator.geolocation)navigator.geolocation.getCurrentPosition(async e=>{try{let{latitude:a,longitude:t}=e.coords,n=await l.A.get(`https://api.aladhan.com/v1/timings?latitude=${a}&longitude=${t}&method=2`,{timeout:3e4,headers:{Accept:"application/json"}});if(n.data&&n.data.data&&n.data.data.timings){let e=n.data.data.timings,a={fajr:e.Fajr.slice(0,5),dhuhr:e.Dhuhr.slice(0,5),asr:e.Asr.slice(0,5),maghrib:e.Maghrib.slice(0,5),isha:e.Isha.slice(0,5)};i(a),localStorage.setItem("prayerTimes",JSON.stringify(a)),localStorage.setItem("prayerTimesLastFetch",Date.now().toString()),E()&&T("Saat ini sedang waktu shalat, pengumuman ditunda","error")}else throw Error("Invalid API response format")}catch(a){console.error("Error fetching prayer times:",a);let e=localStorage.getItem("prayerTimes");e?(i(JSON.parse(e)),T("Menggunakan jadwal shalat tersimpan","info")):T("Gagal mengambil jadwal shalat, menggunakan default","error")}},e=>{console.error("Geolocation error:",e);let a=localStorage.getItem("prayerTimes");a?(i(JSON.parse(a)),T("Menggunakan jadwal shalat tersimpan","info")):T("Gagal mendapatkan lokasi, menggunakan jadwal shalat default","error")},{timeout:1e4,enableHighAccuracy:!1,maximumAge:3e5});else{let e=localStorage.getItem("prayerTimes");e?(i(JSON.parse(e)),T("Menggunakan jadwal shalat tersimpan","info")):T("Geolocation tidak didukung, menggunakan jadwal shalat default","error")}},a=localStorage.getItem("prayerTimes"),t=localStorage.getItem("prayerTimesLastFetch"),n=Date.now();!a||!t||n-parseInt(t)>864e5?e():i(JSON.parse(a))},[]);let O=(0,r.useCallback)(async()=>{try{console.log("Fetching announcements from Vercel Blob storage...");let e=await s(()=>l.A.get("/api/list",{timeout:3e4,headers:{Accept:"application/json"}}),3,1e3);if(e.data&&e.data.announcements){let t=e.data.announcements;console.log(`Found ${t.length} announcements in Blob storage`),a(t),localStorage.setItem("announcements",JSON.stringify(t)),localStorage.setItem("announcementsLastFetch",Date.now().toString()),t.length>0?T(`Berhasil memuat ${t.length} pengumuman dari storage`,"success"):T("Tidak ada pengumuman di storage. Silakan upload file audio.","info")}else throw Error("Invalid response format from list API")}catch(n){console.error("Error fetching announcements from Blob:",n);let e="Gagal memuat pengumuman dari storage";"ECONNABORTED"===n.code?e="Timeout saat memuat pengumuman. Menggunakan data lokal.":n.message.includes("network")&&(e="Masalah jaringan. Menggunakan data lokal.");let t=localStorage.getItem("announcements");if(t){let n=JSON.parse(t);a(n),T(`${e} - Menggunakan ${n.length} pengumuman tersimpan lokal`,"info")}else T(e,"error")}},[T]);(0,r.useEffect)(()=>{{let e=localStorage.getItem("prayerTimes");e&&i(JSON.parse(e)),console.log("Page loaded/reloaded - Fetching fresh data from Vercel Blob storage...");let t=localStorage.getItem("announcements");if(t){let e=JSON.parse(t);a(e),console.log(`Loaded ${e.length} cached announcements for immediate display`)}O()}},[O]),(0,r.useEffect)(()=>{localStorage.setItem("announcements",JSON.stringify(e))},[e]);let P=(0,r.useCallback)(a=>{clearInterval(I.current);let t=60*a,n=Date.now()+1e3*t;localStorage.setItem("countdownEndTime",n.toString()),localStorage.setItem("countdownInterval",a.toString()),g(t),I.current=setInterval(()=>{let t=Math.max(0,Math.floor((n-Date.now())/1e3));if(g(t),t<=0)if(clearInterval(I.current),localStorage.removeItem("countdownEndTime"),localStorage.removeItem("countdownInterval"),E())T("Pemutaran ditunda - Sedang waktu shalat. Mengulang hitungan mundur.","error"),P(a);else{let a=(c+1)%e.length;e.length>0&&C(a)}},1e3)},[E,T,c,e.length]),C=(0,r.useCallback)(a=>{if(clearInterval(I.current),g(0),E()){let e=new Date,a=M();T(`Skip pengumuman - Sedang waktu ${a} hingga ${(e=>{let a=e.getHours().toString().padStart(2,"0"),t=e.getMinutes().toString().padStart(2,"0");return`${a}:${t}`})(new Date(e.getTime()+36e5))}`,"error");let t=parseInt(document.getElementById("playInterval")?.value||"15");setTimeout(()=>{P(t)},100);return}if(a>=0&&a<e.length){m(a);let t=e[a];b.current&&(b.current.src=t.url,b.current.load(),b.current.play().then(()=>{u(!0),T(`Memainkan pengumuman: ${t.name}`,"success"),b.current.onended=()=>{u(!1),P(parseInt(document.getElementById("playInterval")?.value||"15"))}}).catch(e=>{T("Gagal memainkan pengumuman: "+e.message,"error"),P(parseInt(document.getElementById("playInterval")?.value||"15"))}))}},[e,E,M,T,P]);(0,r.useEffect)(()=>{let a=setInterval(()=>{let a=D();a.canPlay&&e.length>0&&!o&&(T(`Waktu ${a.prayerName} telah selesai. Memulai pengumuman otomatis.`,"success"),C(c))},6e4);return()=>clearInterval(a)},[D,e,o,c,C,T]),(0,r.useEffect)(()=>{{let a=localStorage.getItem("countdownEndTime"),t=localStorage.getItem("countdownInterval");if(a&&t){let n=parseInt(a),r=parseInt(t),l=Math.max(0,Math.floor((n-Date.now())/1e3));l>0?(g(l),I.current=setInterval(()=>{let a=Math.max(0,Math.floor((n-Date.now())/1e3));g(a),a<=0&&(clearInterval(I.current),localStorage.removeItem("countdownEndTime"),localStorage.removeItem("countdownInterval"),E()?(T("Pemutaran ditunda - Sedang waktu shalat. Mengulang hitungan mundur.","error"),P(r)):e.length>0&&C((c+1)%e.length))},1e3),T(`Melanjutkan hitungan mundur: ${Math.floor(l/60)}:${(l%60).toString().padStart(2,"0")}`,"info")):(localStorage.removeItem("countdownEndTime"),localStorage.removeItem("countdownInterval"),!E()&&e.length>0&&setTimeout(()=>{C(c)},1e3))}}},[E,T,e.length,c,C,P]),(0,r.useCallback)(()=>{if(0===e.length)return void T("Tidak ada pengumuman yang tersedia untuk diputar.","error");C((c+1)%e.length)},[e,c,T,C]);let A=(0,r.useCallback)(async t=>{if(t>=0&&t<e.length){let n=e[t];try{T("Menghapus pengumuman...","info");let r=await s(()=>l.A.delete("/api/delete",{data:{url:n.url,pathname:n.public_id},headers:{"Content-Type":"application/json"},timeout:3e4}),2,1500);console.log("Delete response:",r.data),t===c&&o&&(b.current&&b.current.pause(),u(!1),clearInterval(I.current),g(0));let i=e.filter((e,a)=>a!==t);a(i),localStorage.setItem("announcements",JSON.stringify(i)),c>=i.length&&m(0),T("Pengumuman berhasil dihapus dari Vercel Blob storage","success")}catch(r){console.error("Delete failed:",r);let n="Gagal menghapus pengumuman";if(r.response){let l=r.response.data;if(n=l.message||n,"Missing BLOB_READ_WRITE_TOKEN environment variable"===l.error)n="Konfigurasi Vercel Blob belum diatur. Periksa environment variables.";else if(404===r.response.status){n="File tidak ditemukan di storage. Mungkin sudah dihapus sebelumnya.";let r=e.filter((e,a)=>a!==t);a(r),localStorage.setItem("announcements",JSON.stringify(r)),c>=r.length&&m(0)}console.error("Server error details:",l)}else n=r.request?"Tidak dapat terhubung ke server. Periksa koneksi internet.":"ECONNABORTED"===r.code?"Timeout saat menghapus file. Mencoba lagi...":r.message||n;T(n,"error")}}},[e,c,o,T]),B=(0,r.useCallback)(()=>0===e.length?void T("Tidak ada pengumuman yang tersedia","error"):o?void T("Pemutaran sudah berjalan","error"):d>0?void T("Hitungan mundur sedang berjalan. Tunggu hingga selesai atau hentikan terlebih dahulu.","error"):void(C(c),T("Pemutaran dimulai","success")),[e,o,d,C,c,T]),$=(0,r.useCallback)(()=>{o&&b.current&&(b.current.pause(),u(!1)),clearInterval(I.current),g(0),localStorage.removeItem("countdownEndTime"),localStorage.removeItem("countdownInterval"),localStorage.removeItem("isPlaybackActive"),T("Pemutaran dan hitungan mundur dihentikan","success")},[o,T]),F=async e=>{let a=e.target.files[0];if(!a)return;if(!a.type.match("audio.*")&&!["audio/mpeg","audio/mp3","audio/wav","audio/ogg","audio/m4a"].includes(a.type))return void T("File harus berupa audio (MP3, WAV, OGG, M4A)","error");if(a.size>0x3200000)return void T("Ukuran file terlalu besar. Maksimal 50MB","error");x(!0),S(0),T("Mengunggah file...","info");let t=new FormData;t.append("audio",a);try{console.log("Starting upload for file:",{name:a.name,type:a.type,size:a.size});let n=await l.A.post("/api/upload",t,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{let a=Math.round(100*e.loaded/e.total);S(a)},timeout:3e5});console.log("Upload response:",n.data);let{url:r,public_id:s}=n.data;if(!r)throw Error("No URL returned from server");await O(),e.target.value="",x(!1),S(0),T("Pengumuman berhasil diunggah ke Vercel Blob!","success")}catch(a){console.error("Upload failed:",a);let e="Gagal mengunggah file";if(a.response){let t=a.response.data;e=t.message||e,"Missing BLOB_READ_WRITE_TOKEN environment variable"===t.error?e="Konfigurasi Vercel Blob belum diatur. Periksa environment variables.":413===a.response.status?e="File terlalu besar untuk diunggah":400===a.response.status&&(e=t.message||"Format file tidak valid"),console.error("Server error details:",t)}else a.request?(e="Tidak dapat terhubung ke server. Periksa koneksi internet.",console.error("Network error:",a.request)):"ECONNABORTED"===a.code?e="Upload timeout. File terlalu besar atau koneksi lambat.":(e=a.message||e,console.error("Unexpected error:",a));T(e,"error"),x(!1),S(0)}};return(0,n.jsxs)("div",{className:"container",children:[(0,n.jsxs)("header",{children:[(0,n.jsxs)("h1",{children:[(0,n.jsx)("i",{className:"fas fa-hospital"})," RAYHAN HOSPITAL"]}),(0,n.jsx)("p",{children:"Putar pengumuman secara periodik dengan dukungan waktu shalat"}),(0,n.jsxs)("div",{className:"time-display",children:[(0,n.jsx)("span",{id:"currentDate",children:f}),(0,n.jsx)("span",{className:"separator",children:"•"}),(0,n.jsx)("span",{id:"currentTime",children:k})]})]}),(0,n.jsxs)("div",{className:"dashboard",children:[(0,n.jsxs)("div",{className:"card",children:[(0,n.jsxs)("h2",{children:[(0,n.jsx)("i",{className:"fas fa-clock"})," Jadwal Waktu Shalat"]}),(0,n.jsx)("div",{className:"prayer-times",children:Object.entries(t).map(e=>{let[a,t]=e,r=new Date,[l,s]=t.split(":").map(Number),i=new Date;i.setHours(l,s,0,0);let o=new Date(i.getTime()+18e5),u=r>=i&&r<=o;return(0,n.jsxs)("div",{className:`prayer-time ${u?"active blinking":""}`,children:[(0,n.jsx)("span",{className:"prayer-name",children:w(a)}),(0,n.jsx)("span",{className:"prayer-time","data-prayer":a,children:t}),u&&(0,n.jsxs)("span",{className:"prayer-indicator",children:[(0,n.jsx)("i",{className:"fas fa-mosque"})," Waktu Sholat"]})]},a)})}),(0,n.jsxs)("div",{className:"now-playing",style:{display:o?"block":"none"},children:[(0,n.jsxs)("strong",{children:[(0,n.jsx)("i",{className:"fas fa-volume-up"})," Sedang Bermain:"]}),(0,n.jsx)("span",{id:"currentAnnouncement",children:e[c]?.name||"Tidak ada"})]}),(0,n.jsx)("audio",{ref:b,controls:!0,style:{display:"none"}}),(0,n.jsxs)("div",{className:"countdown-display",children:[(0,n.jsx)("div",{children:"Pemutaran berikutnya dalam:"}),(0,n.jsx)("div",{id:"countdownTime",children:`${Math.floor(d/60).toString().padStart(2,"0")}:${(d%60).toString().padStart(2,"0")}`})]}),h.message&&(0,n.jsx)("div",{className:`status ${h.type}`,children:h.message})]}),(0,n.jsxs)("div",{className:"card",children:[(0,n.jsxs)("h2",{children:[(0,n.jsx)("i",{className:"fas fa-cog"})," Kontrol Pengumuman"]}),(0,n.jsxs)("div",{className:"announcement-controls",children:[(0,n.jsxs)("div",{className:"control-group",children:[(0,n.jsx)("label",{htmlFor:"playInterval",children:"Interval Pemutaran (menit)"}),(0,n.jsxs)("select",{id:"playInterval",defaultValue:"15",children:[(0,n.jsx)("option",{value:"1",children:"1 menit"}),(0,n.jsx)("option",{value:"5",children:"5 menit"}),(0,n.jsx)("option",{value:"15",children:"15 menit"}),(0,n.jsx)("option",{value:"30",children:"30 menit"}),(0,n.jsx)("option",{value:"60",children:"60 menit"})]})]}),(0,n.jsxs)("div",{className:"control-group",children:[(0,n.jsx)("label",{htmlFor:"volumeControl",children:"Volume"}),(0,n.jsx)("input",{type:"range",id:"volumeControl",min:"0",max:"1",step:"0.1",defaultValue:"0.7",onChange:e=>{b.current&&(b.current.volume=e.target.value)}})]}),(0,n.jsxs)("button",{id:"startBtn",className:"btn-primary",onClick:B,children:[(0,n.jsx)("i",{className:"fas fa-play"})," Mulai Pemutaran"]}),(0,n.jsxs)("button",{id:"stopBtn",className:"btn-danger",onClick:$,children:[(0,n.jsx)("i",{className:"fas fa-stop"})," Hentikan Pemutaran"]}),(0,n.jsxs)("h3",{style:{marginTop:"20px"},children:[(0,n.jsx)("i",{className:"fas fa-upload"})," Unggah File"]}),(0,n.jsxs)("div",{className:"upload-area",onClick:()=>document.getElementById("fileInput").click(),children:[(0,n.jsx)("i",{className:"fas fa-cloud-upload-alt"}),(0,n.jsx)("p",{children:"Klik atau tarik file ke sini untuk mengunggah"}),(0,n.jsx)("p",{className:"small",children:"Format yang didukung: MP3, WAV"}),(0,n.jsx)("input",{type:"file",id:"fileInput",accept:"audio/*",style:{display:"none"},onChange:F}),N&&(0,n.jsx)("div",{className:"progress",style:{display:"block"},children:(0,n.jsx)("div",{className:"progress-bar",style:{width:`${y}%`}})})]})]})]})]}),(0,n.jsxs)("div",{className:"card",children:[(0,n.jsxs)("h2",{children:[(0,n.jsx)("i",{className:"fas fa-list"})," Daftar File"]}),(0,n.jsx)("div",{className:"announcement-list",children:0===e.length?(0,n.jsx)("p",{children:"Belum ada pengumuman. Silakan unggah file audio."}):e.map((e,a)=>(0,n.jsxs)("div",{className:`announcement-item ${a===c&&o?"active":""}`,children:[(0,n.jsx)("span",{children:e.name}),(0,n.jsxs)("div",{className:"announcement-actions",children:[(0,n.jsx)("button",{className:"btn-primary play-btn",onClick:()=>C(a),children:(0,n.jsx)("i",{className:"fas fa-play"})}),(0,n.jsx)("button",{className:"btn-danger delete-btn",onClick:()=>A(a),children:(0,n.jsx)("i",{className:"fas fa-trash"})})]})]},e.url))})]}),(0,n.jsxs)("footer",{children:["\xa9 2023 Sistem Pemutaran Pengumuman Otomatis | Dibangun dengan ",(0,n.jsx)("i",{className:"fas fa-heart",style:{color:"#e74c3c"}})," Rayhan Hospital"]})]})};function o(){return(0,n.jsx)(i,{})}},2936:(e,a,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(1214)}])}},e=>{e.O(0,[40,636,593,792],()=>e(e.s=2936)),_N_E=e.O()}]);